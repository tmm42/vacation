<!doctype>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title><%= meta.title %></title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="client/style.css">

</head>
<body>

<header>
    <h1><%= meta.title %></h1>
    <h3><%= meta.date_range %></h3>
    <% if (title) { %>
    <span class="location-title">Aktueller Ort: <%= title %></span>
    <% } %>
    <div id="map"></div>
</header>

<article>
    <% if (imgs.length) { %>
    <h2>Fotos</h2>
    <span id="resizer">+</span>
    <div class="image-grid">
        <div class="grid-sizer"></div>
        <% for(var i = 0; i < imgs.length; i++) {%>
        <div class="img-item"><img src="<%= imgs[i] %>"></div>
        <% } %>
    </div>
    <% } %>
</article>


<footer>
    &copy; 2018 Timm Kleemann
</footer>


<script src="client/masonry.pkgd.min.js"></script>
<script src="client/imagesloaded.pkgd.min.js"></script>

<script>
    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: <%= location.lat %> , lng: <%= location.lng %> },
            zoom: <%= maps.zoom %>
        });

        /**
        var ctaLayer = new google.maps.KmlLayer({
            url: 'https://domain.de/route.kml',
            map: map
        });

         **/

        var marker = new google.maps.Marker({
            position: {lat: <%= location.lat %>, lng: <%= location.lng %>},
            map: map,
            title: "<%= title %>"
        });



    }

    var imgs = <%-JSON.stringify(imgs)%>;

    if(imgs.length) {
        var elem = document.querySelector('.image-grid');
        var msnry = new Masonry( elem, {
            // options
            itemSelector: '.img-item',
            columnWidth: '.grid-sizer',
            percentPosition: true,
            gutter: 10
        });

        imagesLoaded(elem).on( 'progress', function() {
            // layout Masonry after each image loads
            msnry.layout();
        });
    }

    document.getElementById("resizer").addEventListener('mousedown', function(){
        var currentSize = document.getElementsByClassName('grid-sizer')[0].clientWidth;
        var itemsPerRow = Math.round(window.innerWidth / (currentSize + 10));

        if(itemsPerRow <= 1) {
            itemsPerRow = 4;
        } else {
            itemsPerRow -= 1;
        }
        document.getElementsByClassName('grid-sizer')[0].style.width = "calc((100% / " + itemsPerRow + ") - 10px)";
        var items = document.querySelectorAll('.img-item');
        for(var i = 0; i < items.length; i++) {
            items[i].style.width = "calc((100% / " + itemsPerRow + ") - 10px)";
            msnry.layout();
        }

    })


</script>

<script src="https://maps.googleapis.com/maps/api/js?key=<%= maps.apiKey %>&callback=initMap" async defer></script>

</body>
</html>